<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.Cinema_Management_System.Arrangement.dao.ArrangementDao"><!--namespace:定义一个操作包  -->
    <select id="getArrange" resultType="com.Cinema_Management_System.Arrangement.entity.Arrangement">
        select *
        from Cinema_arrangement
        where arrangement_id = #{arrangementId}
    </select>
    <select id="getArranges" resultType="com.Cinema_Management_System.Arrangement.entity.Arrangement">
        select a.*,m.movie_name
        from Cinema_arrangement a left join Cinema_movie m on a.movie_id = m.movie_id
        <if test="selType != null and selType !='' and selContent != null and selContent != ''">
            <where>
                <if test="selType == 'movieId'">
                    a.movie_id = #{selContent}
                </if>
                <if test="selType == 'movieName'">
                    m.movie_name like CONCAT(CONCAT('%',#{selContent}),'%')
                </if>
                <if test="selType == 'arrangementId'">
                    a.arrangement_id = #{selContent}
                </if>
                <if test="selType == 'arrangementPlace'">
                    a.arrangement_place = #{selContent}
                </if>
                <if test="selType == 'arrangementTime'">
                    a.arrangement_time = = #{selContent}
                </if>
            </where>
        </if>
        limit #{pageStart},#{pageSize}
    </select>
    <select id="getCount" resultType="int">
        select count(*)
        from Cinema_arrangement
        <if test="selType != null and selType !='' and selContent != null and selContent != ''">
            <where>
                <if test="selType == 'movieId'">
                    movie_id = #{selContent}
                </if>
                <if test="selType == 'movieName'">
                    movie_id in (select movie_id from Cinema_movie where movie_name like
                    CONCAT(CONCAT('%',#{selContent}),'%'))
                </if>
                <if test="selType == 'arrangementId'">
                    arrangement_id = #{selContent}
                </if>
                <if test="selType == 'arrangementPlace'">
                    arrangement_place = #{selContent}
                </if>
            </where>
        </if>
    </select>

    <select id="getMovieTime" resultType="string">
       select movie_time from Cinema_movie
       where movie_id = #{movieId};
    </select>

    <select id="getDisableTime" resultType="com.Cinema_Management_System.Arrangement.entity.UsedTime">
        SELECT
        a.arrangement_time,m.movie_time
        FROM
        Cinema_arrangement a,Cinema_movie m
        WHERE
        arrangement_time &gt; #{dayStart} AND arrangement_time &lt; #{dayEnd} AND a.movie_id = m.movie_id AND a.arrangement_place = #{arrangementPlace}
        order by a.arrangement_time
    </select>

    <insert id="addArrangement" parameterType="com.Cinema_Management_System.Arrangement.entity.Arrangement">
        insert into Cinema_arrangement
        value (#{arrangementId},#{arrangementTime},#{arrangementPlace},#{arrangementPrice},#{movieId})
    </insert>

    <delete id="deleteArrangement" parameterType="int">
        delete from Cinema_arrangement
        where arrangement_id = #{arrangementId}
    </delete>

    <delete id="deleteArrangements" parameterType="list">
        delete from Cinema_arrangement where arrangement_id in
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">#{item}</foreach>
    </delete>

    <update id="updateArrangement" parameterType="com.Cinema_Management_System.Arrangement.entity.Arrangement">
        update Cinema_arrangement
        set movie_id = #{movieId},arrangement_time = #{arrangementTime},
        arrangement_price = #{arrangementPrice},arrangement_place = #{arrangementPlace}
        where arrangement_id = #{arrangementId}
    </update>
</mapper>